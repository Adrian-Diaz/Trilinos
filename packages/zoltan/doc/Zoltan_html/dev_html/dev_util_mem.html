<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (X11; U; SunOS 4.1.3_U1 sun4m) [Netscape]">
   <TITLE> Zoltan Developer's Guide:  Utilities</TITLE>
<!
  ------------------------
  | CVS File Information |
  ------------------------
  $RCSfile$
  $Author$
  $Date$
  $Revision$
>

</HEAD>
<BODY BGCOLOR="#FFFFFF">

<DIV ALIGN=right>
<H3>
<IMG SRC="figures/dev_header.gif" ALT="Zoltan Developer's Guide">
</H3></DIV>

<H2>
<A NAME="Memory"></A>Memory Management Utilities</H2>
Several memory allocation and deallocation routines are provided in the
load-balancing library. They are defined in the file <I>all/all_allo.c</I>;
their prototypes for inclusion in other files are in <I>all/all_allo_const.h</I>.
The use of these routines is not mandatory in algorithm development, but
the routines provide helpful error-checking and debugging capabilities,
and the use of them is strongly suggested. It is suggested that developers
use these routines where possible.

<P>The routines included in the utility are listed below.
<BLOCKQUOTE><B><A HREF="#LB_array_alloc">LB_array_alloc</A></B>:&nbsp;
allocates arrays of dimension <I>n</I>, <I>n</I>=0,1,...,4
<BR><B><A HREF="#LB_smalloc">LB_smalloc</A></B>:&nbsp; "safe" version of
malloc.
<BR><B><A HREF="#LB_srealloc">LB_srealloc</A></B>:&nbsp; "safe" version
of realloc.
<BR><B><A HREF="#LB_safe_free">LB_safe_free</A></B>:&nbsp; frees memory
and sets the pointer to NULL.</BLOCKQUOTE>

<HR><A NAME="LB_array_alloc"></A>double *<B>LB_array_alloc</B>(char *<I>
file</I>, int <I>line</I>, int <I>n</I>, int <I>d1</I>, int <I>d2</I>,
..., int <I>dn</I>, int <I>size</I>);&nbsp;
<HR>

<P>The <B>LB_array_alloc</B> routine dynamically allocates an array of
dimension <I>n</I>, <I>n </I>= 0, 1, ..., 4 with size (<I>d1</I> x <I>d2</I>
x ... x <I>dn</I>).
<BR>&nbsp;
<TABLE WIDTH="100%" >
<TR VALIGN=TOP>
<TD VALIGN=TOP WIDTH="20%"><B>Parameters:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; file</I></TD>

<TD>A string containing the name of the file calling the function. The
<I>__FILE__</I> macro can be passed as this argument. This argument is
useful for debugging memory allocation problems.</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; line</I></TD>

<TD>The line number within <I>file</I> of the call to the function. The
<I>__LINE__</I> macro can be passed as this argument. This argument is
useful for debugging memory allocation problems.</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; n</I></TD>

<TD>The number of dimensions in the array to be allocated. Valid values
are 0, 1, 2, 3, or 4.</TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp;&nbsp; <I>d1</I>, <I>d2</I>, ..., <I>dn</I></TD>

<TD>The size of each dimension to be allocated. One argument is included
for each dimension.</TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp;&nbsp; <I>size</I></TD>

<TD>The size (in bytes) of the data objects to be stored in the array.</TD>
</TR>

<TR>
<TD><B>Returned Value:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp; double *</TD>

<TD>A pointer to the starting address of the <I>n</I>-dimensional array,
or NULL if the allocation fails.</TD>
</TR>

<TR>
<TD VALIGN=TOP><B>Example:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP></TD>

<TD>int **<I> x</I> = (int **) <B>LB_array_alloc</B> (<I> __FILE__</I>
, <I>__LINE__</I> , 2, 5, 6, <I>sizeof</I> (int));</TD>
</TR>

<TR>
<TD VALIGN=TOP></TD>

<TD>Allocates a two-dimensional, 5x6-element array of integers.</TD>
</TR>
</TABLE>


<P>&nbsp;

<P>
<HR><A NAME="LB_smalloc"></A>double *<B>LB_smalloc</B>(int <I>n</I> , char
*<I> file</I> , int <I>line</I>);&nbsp;
<HR>

<P>The <B>LB_smalloc</B> function is a "safe" version of malloc. It allocates
a block of memory of size <I>n</I> bytes. Error tests ensuring that <I>n</I>
is a positive number and that space is available to be allocated are performed.

<P>A macro <B>LB_SMALLOC</B> is defined in <I>all/all_allo_const.h</I>.
It takes the argument <I>n</I>, and adds the <I>__FILE__</I> and <I>__LINE__</I>
macros to the argument list of the <B>LB_smalloc</B> call:
<BLOCKQUOTE>#define <B>LB_SMALLOC</B>(<I>n</I>) <B>LB_smalloc</B>((<I>n</I>),
<I>__FILE__</I>, <I>__LINE__</I>)</BLOCKQUOTE>
Using this macro, the developer gains the file and line debugging information
without having to type file and line information in each memory allocation
call.
<BR>&nbsp;
<TABLE WIDTH="100%" >
<TR VALIGN=TOP>
<TD VALIGN=TOP WIDTH="20%"><B>Parameters:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp;&nbsp;<I> n</I></TD>

<TD>The size (in bytes) of the memory-allocation request.</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; file</I></TD>

<TD>A string containing the name of the file calling the function. The
<I>__FILE__</I> macro can be passed as this argument. This argument is
useful for debugging memory allocation problems.</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; line</I></TD>

<TD>The line number within <I>file</I> of the call to the function. The
<I>__LINE__</I> macro can be passed as this argument. This argument is
useful for debugging memory allocation problems.</TD>
</TR>

<TR>
<TD><B>Returned Value:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp; double *</TD>

<TD>A pointer to the starting address of memory allocated.&nbsp; NULL is
returned if <I>n</I> = 0 or the routine is unsuccessful.</TD>
</TR>

<TR>
<TD VALIGN=TOP><B>Example:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP></TD>

<TD>struct <B>LB_Struct</B> *<I>b</I> = (struct <B>LB_Struct</B> *) <B>LB_SMALLOC</B>(<I>sizeof</I>(struct
<B>LB_Struct</B>));</TD>
</TR>

<TR>
<TD VALIGN=TOP></TD>

<TD>Allocates memory for one <B>LB_Struct</B> data structure.&nbsp;</TD>
</TR>
</TABLE>


<P>&nbsp;

<P>
<HR><A NAME="LB_srealloc"></A>double *<B>LB_srealloc</B>(void *<I>ptr</I>,
int <I>n</I>, char *<I>file</I>, int <I>line</I>);&nbsp;
<HR>

<P>The <B>LB_srealloc</B> function is a "safe" version of realloc. It changes
the size of the object pointed to by <I>ptr</I> to <I>n</I> bytes. The
contents of <I>ptr</I> are unchanged up to a minimum of the old and new
sizes. Error tests ensuring that <I>n</I> is a positive number and that
space is available to be allocated are performed.

<P>A macro <B>LB_SREALLOC</B> is defined in <I>all/all_allo_const.h</I>.
It takes the arguments <I>ptr</I> and <I>n</I>, and adds the <I>__FILE__</I>
and <I>__LINE__</I> macros to the argument list of the <B>LB_srealloc</B>
call:
<BLOCKQUOTE>#define <B>LB_SREALLOC</B>(<I>ptr</I>, <I>n</I>) <B>LB_srealloc</B>((<I>ptr</I>),
(<I>n</I>), <I>__FILE__</I>, <I>__LINE__</I>)</BLOCKQUOTE>
Using this macro, the developer gains the file and line debugging information
without having to type file and line information in each memory allocation
call.
<BR>&nbsp;
<TABLE WIDTH="100%" >
<TR VALIGN=TOP>
<TD VALIGN=TOP WIDTH="20%"><B>Parameters:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp;&nbsp; <I>ptr</I></TD>

<TD>Pointer to allocated memory to be re-sized.</TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp;&nbsp;<I> n</I></TD>

<TD>The size (in bytes) of the memory-allocation request.</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; file</I></TD>

<TD>A string containing the name of the file calling the function. The
<I>__FILE__</I> macro can be passed as this argument. This argument is
useful for debugging memory allocation problems.</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; line</I></TD>

<TD>The line number within <I>file</I> of the call to the function. The
<I>__LINE__</I> macro can be passed as this argument. This argument is
useful for debugging memory allocation problems.</TD>
</TR>

<TR>
<TD><B>Returned Value:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp; double *</TD>

<TD>A pointer to the starting address of memory allocated.&nbsp; If the
routine is unsuccessful, NULL is returned and *<I>ptr</I> is unchanged.</TD>
</TR>

<TR>
<TD VALIGN=TOP><B>Example:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP></TD>

<TD><I>int</I> *<I>b</I> = (<I>int </I>*) <B><A HREF="#LB_smalloc">LB_SMALLOC</A></B>
(<I>sizeof</I> (struct <B>LB_Struct</B>));&nbsp;
<BR><I>b</I> = (<I>int </I>*) <B>LB_SREALLOC</B> (<I>b</I>, 2*<I>n</I>);</TD>
</TR>

<TR>
<TD VALIGN=TOP></TD>

<TD>Reallocates memory for <I>b</I> from length <I>n</I> to length 2*<I>n</I>.&nbsp;</TD>
</TR>
</TABLE>


<P>&nbsp;

<P>
<HR><A NAME="LB_safe_free"></A>void <B>LB_safe_free</B>(void **<I>ptr</I>);&nbsp;
<HR>

<P>The <B>LB_safe_free</B> function calls the system's "free" function
for the memory pointed to by <I>*ptr</I>. Before returning, it sets <I>*ptr</I>
to NULL. Error checking is performed to prevent attempts to free NULL pointers.
<BR>&nbsp;
<TABLE WIDTH="100%" >
<TR VALIGN=TOP>
<TD VALIGN=TOP WIDTH="20%"><B>Parameters:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp;&nbsp; <I>ptr</I></TD>

<TD>Address of a pointer to the memory to be freed. Upon return, <I>ptr</I>
is set to NULL.</TD>
</TR>

<TR>
<TD VALIGN=TOP><B>Example:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP></TD>

<TD><B>LB_safe_free</B>((<I>void</I> **) &amp;<I> x</I>);</TD>
</TR>

<TR>
<TD VALIGN=TOP></TD>

<TD>Frees memory associated with the variable <I>x</I>; upon return, <I>x</I>
is NULL.</TD>
</TR>
</TABLE>

<HR WIDTH="100%">
<BR>[<A HREF="dev.html">Table of Contents</A>&nbsp; |&nbsp; <A HREF="dev_util_comm.html">Next:&nbsp;
Irregular Communication Library</A>&nbsp; |&nbsp; <A HREF="dev_util.html">Previous:&nbsp;
Utilities</A>]
</BODY>
</HTML>
